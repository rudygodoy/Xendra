<jasperReport xmlns="http://jasperreports.sourceforge.net/jasperreports" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://jasperreports.sourceforge.net/jasperreports http://jasperreports.sourceforge.net/xsd/jasperreport.xsd" name="ComisionesVendedor" pageWidth="842" pageHeight="595" orientation="Landscape" whenNoDataType="NoDataSection" columnWidth="794" leftMargin="28" rightMargin="20" topMargin="20" bottomMargin="20" uuid="79089c29-dde7-49c0-99e7-f31f4bfdba30">
  <property name="Identifier" value="41e6c440-fffb-c503-85f4-e1af176a215b" />
  <property name="Synchronized" value="2016-10-11 15:12:18.0" />
  <property name="FileName" value="Comisiones_V7.jrxml" />
  <property name="ireport.zoom" value="2.0" />
  <property name="ireport.x" value="0" />
  <property name="ireport.y" value="0" />
  <property name="net.sf.jasperreports.export.xls.column.width.ratio" value="1.5f" />
  <property name="net.sf.jasperreports.export.xls.remove.empty.space.between.columns" value="true" />
  <property name="net.sf.jasperreports.export.xls.remove.empty.space.between.rows" value="true" />
  <parameter name="DateFrom1" class="java.sql.Timestamp">
    <defaultValueExpression><![CDATA[java.sql.Timestamp.valueOf("1992-01-01 00:00:00")]]></defaultValueExpression>
  </parameter>
  <parameter name="DateFrom2" class="java.sql.Timestamp">
    <defaultValueExpression><![CDATA[java.sql.Timestamp.valueOf("1992-01-01 00:00:00")]]></defaultValueExpression>
  </parameter>
  <parameter name="SalesRep_ID" class="java.math.BigDecimal">
    <defaultValueExpression><![CDATA[new BigDecimal(0)]]></defaultValueExpression>
  </parameter>
  <queryString><![CDATA[SELECT
(case
when (coalesce(al.c_payment_id,0) != 0)
	then 'PG'
when (coalesce(al.c_cashline_id,0) != 0)
	then 'EF'
else
	'AS'
end) as pagoTipo,

(
case
when (coalesce(al.c_payment_id,0) != 0)
	then (select documentno from c_payment where al.c_payment_id = c_payment_id)
when (coalesce(al.c_cashline_id,0) != 0)
	then '99999'
else
	ah.documentno
end
) as pagoNro,
--al.c_payment_id,
  cd_ds.multiplyrate as TC_ds,
  cd_es.multiplyrate as TC_es,
ah.datetrx as pagoFecha,

al.c_bpartner_id,
  (select name from c_bpartner where ah.ad_client_id = c_bpartner.ad_client_id and al.c_bpartner_id = c_bpartner.c_bpartner_id) as partnerName,

--ah.documentno,
--ah.c_currency_id as currencyPayed,
c_currency.iso_code as iso_code,
al.amount as payamt,
--inv.c_doctype_id,
(
case when inv.c_doctype_id = 1001040
	then 'FC'
     when inv.c_doctype_id = 1001094 --1001041
	then 'BL'
     else
	'NC'
end
) as docPagoTipo,
  (case when tbl_pc.iso_code = 'S/.'
		then 1.00
	when tbl_pc.iso_code = '$'
		then cd_ds.multiplyrate
	when tbl_pc.iso_code = 'E'
		then cd_es.multiplyrate
	end
  ) as tcItem,
inv.documentno as paiddocnro,
--inv.c_invoice_id,
--al.c_order_id,
  (select documentno from c_order where al.ad_client_id = c_order.ad_client_id and inv.c_order_id = c_order.c_order_id) as "orderNro",
    inv.salesrep_id AS "vendorId",
c_project.plannedqty,
  (select name from c_bpartner where c_bpartner.c_bpartner_id = (select c_bpartner_id  from ad_user where ad_user_id = $P{SalesRep_ID}) and ah.ad_client_id = c_bpartner.ad_client_id) as vendorName,
    tbl_pc.iso_code as isoCodeItem,
--inv.c_currency_id as currencyDocPayed,
--inv.c_conversiontype_id as contype_factura,
inv.totallines as totalDcotPago ,
inv.totallines*(1+(taxtbl.rate)/100) as totalConIgv,
inv.grandtotal,
  (
	-- Dividmos el monto total sin igv vs el montot total sin igv y determinamos el %
	round((invline.linenetamt *100.0)/(
		--  el monto sin igv
		inv.grandtotal*100/(100.00+taxtbl.rate)),2)
   ) as porParaComision,

   getFactorComisionable(al.amount,c_currency.iso_code,inv.grandtotal,tbl_pc.iso_code , cd_ds.multiplyrate,cd_es.multiplyrate) as factor,
   ---calc_comisionitem(al.amount,c_currency.iso_code,inv.grandtotal,tbl_pc.iso_code ,invline.linenetamt,
--	cd_ds.multiplyrate,cd_es.multiplyrate,taxtbl.rate,plannedqty) as comision,

 (case when tbl_pc.iso_code = '$'
	then invline.linenetamt
	else 0
	end) as itemBaseDolares,
  (case when tbl_pc.iso_code = 'S/.'
	then invline.linenetamt
	else 0
	end) as itemBaseSoles,
  (case when tbl_pc.iso_code = 'E'
	then invline.linenetamt
	else 0
	end) as itemBaseEuros,
--invline.c_project_id,
  (select name from m_product where m_product.ad_client_id = ah.ad_client_id
  and m_product.m_product_id = invline.m_product_id) as productName
FROM C_ALLOCATIONLINE al
join c_allocationhdr ah on ah.c_allocationhdr_id = al.c_allocationhdr_id
join c_invoice inv on inv.c_invoice_id = al.c_invoice_id
LEFT OUTER JOIN c_invoiceline invline on (invline.c_invoice_id = inv.c_invoice_id)
LEFT OUTER JOIN c_tax taxtbl on ( invline.ad_client_id = taxtbl.ad_client_id  and taxtbl.c_tax_id = invline.c_tax_id)
  LEFT OUTER JOIN c_currency tbl_pc on ( inv.c_currency_id = tbl_pc.c_currency_id)
  LEFT OUTER JOIN c_currency  on ( ah.c_currency_id = c_currency.c_currency_id)

 LEFT OUTER JOIN c_project  on ( invline.ad_client_id = c_project.ad_client_id AND invline.c_project_id = c_project.c_project_id)
 -- Tipo de cambio dolar a soles
 LEFT OUTER JOIN c_conversion_rate cd_ds on (cd_ds.c_conversion_rate_id=  (select c_conversion_rate_id from c_conversion_rate cds2 where cds2.c_currency_id = 100
  and cds2.c_currency_id_to = 308
  and
  cds2.c_conversiontype_id = inv.c_conversiontype_id and date(inv.DateInvoiced) between cds2.validfrom and cds2.validto   order by  c_conversion_rate_id  desc limit 1))

 -- Tipo de cambio euros a soles
  LEFT OUTER JOIN c_conversion_rate cd_es on (cd_es.c_conversion_rate_id=  (select c_conversion_rate_id from c_conversion_rate cds2 where cds2.c_currency_id = 102
  and cds2.c_currency_id_to = 308
  and
  cds2.c_conversiontype_id = inv.c_conversiontype_id and date(inv.DateInvoiced) between cds2.validfrom and cds2.validto  order by  c_conversion_rate_id  desc limit 1))

where
ah.dateacct::DATE between DATE($P{DateFrom1}) and DATE($P{DateFrom2})
and
(inv.c_doctype_id = 1001040 or inv.c_doctype_id = 1001094 or inv.c_doctype_id = 1001042)

and (ah.docstatus = 'CO' or ah.docstatus = 'CL')
and ah.isactive = 'Y'
and al.ad_client_id = 1000026
and al.ad_org_id = 1000069
and inv.salesrep_id = $P{SalesRep_ID}
--and true =
--(case when (inv.c_doctype_id = 1001040 and inv.documentno <= '0025050')
--    then false
--    else true
--end)
and plannedqty is not null and plannedqty > 0
--and coalesce(al.ad_table_id,0) = 0
and (coalesce(al.ad_table_id,0) = 0 or (al.ad_table_id = 318 and refdocumentno = inv.documentno and al.c_payment_id is not null))
and inv.issotrx = 'Y'

union
(
select

g.pagoTipo,
  (
  case when g.pagoTipo = 'CJ'
   then coalesce((select documentno from c_groupdoc where c_groupdoc_id =
	(select c_groupdoc_id from c_groupdoc where c_allocationhdr_id = g.c_allocationhdr_id)),g.c_allocationhdr_id || '')
   else

	(select documentno from c_retention where c_retention_id =
	(select record_id from c_allocationline l where
		l.c_allocationhdr_id = g.c_allocationhdr_id
		and l.c_invoice_id = g.c_invoice_id
		and l.amount = g.amount
		and g.ad_table_id = 1000099))
  end
  ) as pagoNro,
  cd_ds.multiplyrate as TC_ds,
  cd_es.multiplyrate as TC_es,
  datetrx as pagoFecha,
  g.c_bpartner_id,
  (select name from c_bpartner where inv.ad_client_id = c_bpartner.ad_client_id and g.c_bpartner_id = c_bpartner.c_bpartner_id) as partnerName,
  c_currency.iso_code as iso_code,
  g.amount as payamt,
(
case when inv.c_doctype_id = 1001040
	then 'FC'
     when inv.c_doctype_id = 1001041
	then 'BL'
     else
	'NC'
end
) as docPagoTipo,
  (case when tbl_pc.iso_code = 'S/.'
		then 1.00
	when tbl_pc.iso_code = '$'
		then cd_ds.multiplyrate
	when tbl_pc.iso_code = 'E'
		then cd_es.multiplyrate
	end
  ) as tcItem,
inv.documentno as paiddocnro,
  (select documentno from c_order where inv.ad_client_id = c_order.ad_client_id and inv.c_order_id = c_order.c_order_id) as "orderNro",
    inv.salesrep_id AS "vendorId",
c_project.plannedqty,
  (select name from c_bpartner where c_bpartner.c_bpartner_id = (select c_bpartner_id  from ad_user where ad_user_id = $P{SalesRep_ID}) and inv.ad_client_id = c_bpartner.ad_client_id) as vendorName,
    tbl_pc.iso_code as isoCodeItem,
inv.totallines as totalDcotPago ,
inv.totallines*(1+(taxtbl.rate)/100) as totalConIgv,
inv.grandtotal,
  (
	-- Dividmos el monto total sin igv vs el montot total sin igv y determinamos el %
	round((invline.linenetamt *100.0)/(
		--  el monto sin igv
		inv.grandtotal*100/(100.00+taxtbl.rate)),2)
   ) as porParaComision,

   getFactorComisionable(g.amount,c_currency.iso_code,inv.grandtotal,tbl_pc.iso_code , cd_ds.multiplyrate,cd_es.multiplyrate) as factor,
  -- calc_comisionitem(g.amount,c_currency.iso_code,inv.grandtotal,tbl_pc.iso_code ,invline.linenetamt,
--	cd_ds.multiplyrate,cd_es.multiplyrate,taxtbl.rate,plannedqty) as comision,
 (case when tbl_pc.iso_code = '$'
	then invline.linenetamt
	else 0
	end) as itemBaseDolares,
  (case when tbl_pc.iso_code = 'S/.'
	then invline.linenetamt
	else 0
	end) as itemBaseSoles,
  (case when tbl_pc.iso_code = 'E'
	then invline.linenetamt
	else 0
	end) as itemBaseEuros,
  (select name from m_product where m_product.ad_client_id = inv.ad_client_id
  and m_product.m_product_id = invline.m_product_id) as productName

from
(
	SELECT
       ad_table_id,
	(case when ad_table_id =1000065
		then 'CJ'
		else 'RT'
	end
	) as pagoTipo,
	al.c_allocationhdr_id,
	ah.datetrx,
	al.c_currency_id,
	c_bpartner_id,
	c_invoice_id,
	sum(amount) as amount

	FROM C_ALLOCATIONLINE al
	join c_allocationhdr ah on ah.c_allocationhdr_id = al.c_allocationhdr_id
	where
	ah.created::DATE between DATE($P{DateFrom1}) and DATE($P{DateFrom2})
	and (ah.docstatus = 'CO' or ah.docstatus = 'CL')
	and ah.isactive = 'Y'
	and al.ad_client_id = 1000026
	and al.ad_org_id = 1000069
	and coalesce(al.ad_table_id,0) > 0
	and coalesce(al.record_id,0) > 0
	and ad_table_id =1000065 -- letras
	group by al.c_allocationhdr_id,al.c_invoice_id,al.c_bpartner_id,ah.datetrx,al.c_currency_id,al.ad_table_id
) as g
join c_invoice inv on inv.c_invoice_id = g.c_invoice_id
LEFT OUTER JOIN c_invoiceline invline on (invline.c_invoice_id = inv.c_invoice_id)
LEFT OUTER JOIN c_tax taxtbl on ( invline.ad_client_id = taxtbl.ad_client_id  and taxtbl.c_tax_id = invline.c_tax_id)
  LEFT OUTER JOIN c_currency tbl_pc on ( inv.c_currency_id = tbl_pc.c_currency_id)
  LEFT OUTER JOIN c_currency  on ( g.c_currency_id = c_currency.c_currency_id)

 LEFT OUTER JOIN c_project  on ( invline.ad_client_id = c_project.ad_client_id AND invline.c_project_id = c_project.c_project_id)
 -- Tipo de cambio dolar a soles
 LEFT OUTER JOIN c_conversion_rate cd_ds on (cd_ds.c_conversion_rate_id=  (select c_conversion_rate_id from c_conversion_rate cds2 where cds2.c_currency_id = 100
  and cds2.c_currency_id_to = 308
  and
  cds2.c_conversiontype_id = inv.c_conversiontype_id and date(inv.DateInvoiced) between cds2.validfrom and cds2.validto   order by  c_conversion_rate_id  desc limit 1))

 -- Tipo de cambio euros a soles
  LEFT OUTER JOIN c_conversion_rate cd_es on (cd_es.c_conversion_rate_id=  (select c_conversion_rate_id from c_conversion_rate cds2 where cds2.c_currency_id = 102
  and cds2.c_currency_id_to = 308
  and
  cds2.c_conversiontype_id = inv.c_conversiontype_id and date(inv.DateInvoiced) between cds2.validfrom and cds2.validto  order by  c_conversion_rate_id  desc limit 1))

where
(inv.c_doctype_id = 1001040 or inv.c_doctype_id = 1001094 or inv.c_doctype_id = 1001042)
and inv.salesrep_id = $P{SalesRep_ID}
and plannedqty is not null and plannedqty > 0
and inv.issotrx = 'Y'
)
-- Facturas pagadas por factura adelantada
union
(

-- PARA FACTURAS PAGADAS POR FACTURAS ADELANTADAS
select
'FA' as pagoTipo,
'??' as pagoNro,
cd_ds.multiplyrate as TC_ds,
cd_es.multiplyrate as TC_es,
inv.dateinvoiced as pagoFecha,
inv.c_bpartner_id,
(select name from c_bpartner where inv.ad_client_id = c_bpartner.ad_client_id and inv.c_bpartner_id = c_bpartner.c_bpartner_id) as partnerName,
c_currency.iso_code as iso_code,
faamount as payamt,
'FC'as docPagoTipo,
 (case when tbl_pc.iso_code = 'S/.'
		then 1.00
	when tbl_pc.iso_code = '$'
		then cd_ds.multiplyrate
	when tbl_pc.iso_code = 'E'
		then cd_es.multiplyrate
	end
) as tcItem,
inv.documentno as paiddocnro,
(select documentno from c_order where inv.ad_client_id = c_order.ad_client_id and inv.c_order_id = c_order.c_order_id) as "orderNro",
inv.salesrep_id AS "vendorId",
c_project.plannedqty,
(select name from c_bpartner where c_bpartner.c_bpartner_id = (select c_bpartner_id  from ad_user where ad_user_id = $P{SalesRep_ID}) and inv.ad_client_id = c_bpartner.ad_client_id) as vendorName,
tbl_pc.iso_code as isoCodeItem,
totalsinigv as totalDcotPago ,
totalsinigv*(1+(taxtbl.rate)/100) as totalConIgv,
-- Y el IGV que pasa con el
totalsinigv as grandtotal,
(
	-- Dividmos el monto total sin igv vs el montot total sin igv y determinamos el %
	round((il.linenetamt *100.0)/(--  el monto sin igv
		totalsinigv),2)
) as porParaComision,

getFactorComisionable(faamount,c_currency.iso_code,totalsinigv,tbl_pc.iso_code , cd_ds.multiplyrate,cd_es.multiplyrate) as factor,
(case when tbl_pc.iso_code = '$'
	then il.linenetamt
	else 0
	end) as itemBaseDolares,
(case when tbl_pc.iso_code = 'S/.'
	then il.linenetamt
	else 0
	end) as itemBaseSoles,
(case when tbl_pc.iso_code = 'E'
	then il.linenetamt
	else 0
	end) as itemBaseEuros,
(select name from m_product where m_product.ad_client_id = inv.ad_client_id and m_product.m_product_id = il.m_product_id) as productName
 from (
	-- se agrupan
	select invoice_id,totalsinigv,fadocumentno,faamount from (
		-- Se buscan las canceladas x adelantadas
			SELECT sum((case when il.linenetamt > 0 then il.linenetamt else 0 end)) as totalsinigv,
				inv.c_invoice_id as invoice_id,
				max(invfa.documentno) as fadocumentno,
				-- Est deberia ser el ia.amount pero por ahora no funciona
				sum((case when il.linenetamt < 0 then -1*il.linenetamt else 0 end)) as faamount
			from c_invoice inv
				join c_invoiceline il on il.c_invoice_id = inv.c_invoice_id
				left join c_invoiceadvanceline ilfa on ilfa.c_invoiceline_id = il.c_invoiceline_id
				left join c_invoiceadvance ia on ia.c_invoiceadvance_id = ilfa.c_invoiceadvance_id
				left join c_invoice invfa on invfa.c_invoice_id = ia.c_invoice_id
		where
			(inv.docstatus = 'CO' or inv.docstatus = 'CL') and inv.isactive='Y' and inv.issotrx='Y'
			-- Esta condicion solo debe estar en las adelantadas
			and  inv.totallines = 0 and  inv.grandtotal = 0
			and inv.c_doctype_id = 1001040
			-- Esto quita las lineas negativas que corresponden al adelanto.
			-- por ahora no se filtraran ya que se reqiere saber el monto aplicado por lo que lo
			-- que el acumulado negativo sera usao para ese fin
			--and il.linenetamt < 0
		group by inv.c_invoice_id
	) fact_adl
	where totalsinigv > 0
) df
join c_invoice inv on inv.c_invoice_id = invoice_id
join c_invoiceline il on il.c_invoice_id = inv.c_invoice_id and il.linenetamt > 0
LEFT OUTER JOIN c_tax taxtbl on ( il.ad_client_id = taxtbl.ad_client_id  and taxtbl.c_tax_id = il.c_tax_id)
LEFT OUTER JOIN c_currency tbl_pc on ( inv.c_currency_id = tbl_pc.c_currency_id)
LEFT OUTER JOIN c_currency  on ( inv.c_currency_id = c_currency.c_currency_id)

LEFT OUTER JOIN c_project  on ( il.ad_client_id = c_project.ad_client_id AND il.c_project_id = c_project.c_project_id)
 -- Tipo de cambio dolar a soles
LEFT OUTER JOIN c_conversion_rate cd_ds on (cd_ds.c_conversion_rate_id=  (select c_conversion_rate_id from c_conversion_rate cds2 where cds2.c_currency_id = 100
  and cds2.c_currency_id_to = 308
  and
  cds2.c_conversiontype_id = inv.c_conversiontype_id and date(inv.DateInvoiced) between cds2.validfrom and cds2.validto   order by  c_conversion_rate_id  desc limit 1))

 -- Tipo de cambio euros a soles
LEFT OUTER JOIN c_conversion_rate cd_es on (cd_es.c_conversion_rate_id=  (select c_conversion_rate_id from c_conversion_rate cds2 where cds2.c_currency_id = 102
  and cds2.c_currency_id_to = 308
  and
  cds2.c_conversiontype_id = inv.c_conversiontype_id and date(inv.DateInvoiced) between cds2.validfrom and cds2.validto  order by  c_conversion_rate_id  desc limit 1))
where
inv.dateinvoiced::DATE between date($P{DateFrom1}) and date($P{DateFrom2})
and inv.salesrep_id = $P{SalesRep_ID}
and plannedqty is not null and plannedqty > 0

)
order by pagofecha,pagotipo,pagoNro,paiddocnro]]></queryString>
  <field name="pagotipo" class="java.lang.String" />
  <field name="pagonro" class="java.lang.String" />
  <field name="tc_ds" class="java.math.BigDecimal" />
  <field name="tc_es" class="java.math.BigDecimal" />
  <field name="pagofecha" class="java.sql.Timestamp" />
  <field name="c_bpartner_id" class="java.math.BigDecimal" />
  <field name="partnername" class="java.lang.String" />
  <field name="iso_code" class="java.lang.String" />
  <field name="payamt" class="java.math.BigDecimal" />
  <field name="docpagotipo" class="java.lang.String" />
  <field name="tcitem" class="java.math.BigDecimal" />
  <field name="paiddocnro" class="java.lang.String" />
  <field name="orderNro" class="java.lang.String" />
  <field name="vendorId" class="java.math.BigDecimal" />
  <field name="plannedqty" class="java.math.BigDecimal" />
  <field name="vendorname" class="java.lang.String" />
  <field name="isocodeitem" class="java.lang.String" />
  <field name="totaldcotpago" class="java.math.BigDecimal" />
  <field name="totalconigv" class="java.math.BigDecimal" />
  <field name="grandtotal" class="java.math.BigDecimal" />
  <field name="porparacomision" class="java.math.BigDecimal" />
  <field name="factor" class="java.math.BigDecimal" />
  <field name="itembasedolares" class="java.math.BigDecimal" />
  <field name="itembasesoles" class="java.math.BigDecimal" />
  <field name="itembaseeuros" class="java.math.BigDecimal" />
  <field name="productname" class="java.lang.String" />
  <variable name="comision_1" class="java.math.BigDecimal" calculation="Sum">
    <variableExpression><![CDATA[$F{itembasedolares}.add($F{itembasesoles}).add($F{itembaseeuros}).multiply($F{tcitem})]]></variableExpression>
  </variable>
  <variable name="comision_2" class="java.math.BigDecimal" calculation="Sum">
    <variableExpression><![CDATA[$V{comision}]]></variableExpression>
  </variable>
  <variable name="totSolesItem" class="java.math.BigDecimal" resetType="None">
    <variableExpression><![CDATA[$F{itembasedolares}.add($F{itembasesoles}).add($F{itembaseeuros}).multiply($F{tcitem})]]></variableExpression>
  </variable>
  <variable name="comision" class="java.math.BigDecimal" resetType="None">
    <variableExpression><![CDATA[($F{factor}.doubleValue() > 93.99 && $F{factor}.doubleValue() < 94.01) ?
    $V{totSolesItem}.multiply(new BigDecimal(100)).multiply($F{plannedqty}).divide(new BigDecimal(10000))
:
    $V{totSolesItem}.multiply($F{factor}).multiply($F{plannedqty}).divide(new BigDecimal(10000))]]></variableExpression>
  </variable>
  <group name="g_vendor">
    <groupExpression><![CDATA[$F{vendorId}]]></groupExpression>
    <groupHeader>
      <band splitType="Stretch" />
    </groupHeader>
  </group>
  <group name="g_pago">
    <groupExpression><![CDATA[$F{pagonro}]]></groupExpression>
    <groupHeader>
      <band splitType="Stretch" />
    </groupHeader>
  </group>
  <group name="g_docnro">
    <groupExpression><![CDATA[$F{paiddocnro}]]></groupExpression>
  </group>
  <title>
    <band height="20" splitType="Stretch" />
  </title>
  <pageHeader>
    <band height="56" splitType="Stretch">
      <staticText>
        <reportElement x="303" y="7" width="188" height="17" uuid="38b3015f-e20f-43c9-a480-a4664f65797c" />
        <textElement textAlignment="Center">
          <font isBold="true" />
        </textElement>
        <text><![CDATA[LIQUIDACION DE COMISIONES]]></text>
      </staticText>
      <staticText>
        <reportElement x="2" y="41" width="44" height="10" isPrintWhenDetailOverflows="true" printWhenGroupChanges="g_pago" uuid="088ae11e-eefe-49f6-9f08-4a4f114209f6" />
        <textElement markup="none">
          <font size="6" isBold="true" />
        </textElement>
        <text><![CDATA[Vendedor :]]></text>
      </staticText>
      <staticText>
        <reportElement x="303" y="19" width="188" height="17" uuid="84b7d39b-c1b3-4f4e-848e-392beb4a5b11" />
        <textElement textAlignment="Center">
          <font isBold="true" />
        </textElement>
        <text><![CDATA[OHMLUX]]></text>
      </staticText>
      <textField isBlankWhenNull="false">
        <reportElement key="textField-1" x="261" y="32" width="273" height="14" forecolor="#000000" uuid="7d3e2ceb-f568-43e0-a4ec-4f6656078a39" />
        <box>
          <topPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000" />
          <leftPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000" />
          <bottomPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000" />
          <rightPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000" />
        </box>
        <textElement textAlignment="Center">
          <font size="8" isItalic="true" pdfFontName="Helvetica-Oblique" />
        </textElement>
        <textFieldExpression><![CDATA["Del " + DateFormat.getDateInstance().format($P{DateFrom1}) + " al " + DateFormat.getDateInstance().format($P{DateFrom2})]]></textFieldExpression>
      </textField>
      <textField evaluationTime="Report" isBlankWhenNull="false">
        <reportElement key="textField-7" x="771" y="40" width="22" height="12" uuid="0ec926df-f4b7-476f-8554-5cc45c2fd537" />
        <textElement>
          <font size="6" isItalic="true" pdfFontName="Helvetica-Oblique" />
        </textElement>
        <textFieldExpression><![CDATA["" + $V{PAGE_NUMBER} + ""]]></textFieldExpression>
      </textField>
      <textField isBlankWhenNull="false">
        <reportElement key="textField-6" x="696" y="40" width="75" height="12" uuid="c23916fc-c542-45b2-9787-39e6c2b02433" />
        <textElement textAlignment="Right">
          <font size="6" isItalic="true" pdfFontName="Helvetica-Oblique" />
        </textElement>
        <textFieldExpression><![CDATA["Pag. " + $V{PAGE_NUMBER} + " de "]]></textFieldExpression>
      </textField>
      <textField pattern="hh:mm aaa" isBlankWhenNull="false">
        <reportElement key="textField-3" x="764" y="7" width="28" height="12" uuid="7fe74600-ae82-4cc0-a17b-9127b934caa7" />
        <textElement verticalAlignment="Top">
          <font size="8" isItalic="false" />
        </textElement>
        <textFieldExpression><![CDATA[new Date()]]></textFieldExpression>
      </textField>
      <textField pattern="dd/MM/yyyy" isBlankWhenNull="false">
        <reportElement key="textField-2" x="712" y="7" width="52" height="18" uuid="f5f51eea-9d28-4496-aaeb-b5521e822ea1" />
        <textElement verticalAlignment="Top">
          <font size="8" isItalic="false" />
        </textElement>
        <textFieldExpression><![CDATA[new Date()]]></textFieldExpression>
      </textField>
      <staticText>
        <reportElement key="staticText-20" x="614" y="7" width="100" height="20" uuid="74dff919-f27a-4908-9168-4dd9e6779220" />
        <textElement>
          <font size="8" isBold="true" pdfFontName="Helvetica-Bold" />
        </textElement>
        <text><![CDATA[Fecha de Impresion:]]></text>
      </staticText>
      <textField>
        <reportElement mode="Transparent" x="44" y="41" width="199" height="10" forecolor="#000000" backcolor="#FFFFFF" uuid="3df034af-3644-4350-911a-115f8d6b6626" />
        <textElement textAlignment="Left" verticalAlignment="Top" rotation="None" markup="none">
          <font fontName="SansSerif" size="6" isBold="true" isItalic="false" isUnderline="false" isStrikeThrough="false" pdfFontName="Helvetica" pdfEncoding="Cp1252" isPdfEmbedded="false" />
          <paragraph lineSpacing="Single" />
        </textElement>
        <textFieldExpression><![CDATA[$F{vendorname}]]></textFieldExpression>
      </textField>
    </band>
  </pageHeader>
  <columnHeader>
    <band height="38" splitType="Stretch">
      <staticText>
        <reportElement x="0" y="13" width="37" height="10" isPrintWhenDetailOverflows="true" printWhenGroupChanges="g_pago" uuid="24621e31-4d03-4be5-af46-fb932b2b6edb" />
        <textElement markup="none">
          <font size="6" isBold="true" />
        </textElement>
        <text><![CDATA[Fecha]]></text>
      </staticText>
      <staticText>
        <reportElement x="48" y="13" width="47" height="10" isPrintWhenDetailOverflows="true" printWhenGroupChanges="g_pago" uuid="c18edc0c-9d9d-4534-a38e-b0934ee64e76" />
        <textElement markup="none">
          <font size="6" isBold="true" />
        </textElement>
        <text><![CDATA[Nro Pago]]></text>
      </staticText>
      <staticText>
        <reportElement x="106" y="13" width="32" height="10" isPrintWhenDetailOverflows="true" printWhenGroupChanges="g_pago" uuid="4bba1d75-3bbc-4dbd-86a6-f2f02ac2e6f5" />
        <textElement textAlignment="Right" markup="none">
          <font size="6" isBold="true" />
        </textElement>
        <text><![CDATA[Monto]]></text>
      </staticText>
      <staticText>
        <reportElement x="142" y="13" width="22" height="10" isPrintWhenDetailOverflows="true" printWhenGroupChanges="g_pago" uuid="b1b8320b-1847-4819-a553-a259bf5d4e27" />
        <textElement markup="none">
          <font size="6" isBold="true" />
        </textElement>
        <text><![CDATA[O/V]]></text>
      </staticText>
      <staticText>
        <reportElement x="167" y="13" width="15" height="18" isPrintWhenDetailOverflows="true" printWhenGroupChanges="g_pago" uuid="3368e6aa-75b0-4b60-8c28-54c69149bfbe" />
        <textElement markup="none">
          <font size="6" isBold="true" />
        </textElement>
        <text><![CDATA[Tipo Doc.]]></text>
      </staticText>
      <staticText>
        <reportElement x="187" y="13" width="27" height="18" isPrintWhenDetailOverflows="true" printWhenGroupChanges="g_pago" uuid="4c6b607a-9108-4b91-a3a3-065890bf45d4" />
        <textElement markup="none">
          <font size="6" isBold="true" />
        </textElement>
        <text><![CDATA[Nro.Doc]]></text>
      </staticText>
      <staticText>
        <reportElement x="219" y="13" width="136" height="10" isPrintWhenDetailOverflows="true" printWhenGroupChanges="g_pago" uuid="c712d823-902c-455c-8ae8-6807786889bb" />
        <textElement markup="none">
          <font size="6" isBold="true" />
        </textElement>
        <text><![CDATA[Clente]]></text>
      </staticText>
      <staticText>
        <reportElement x="369" y="13" width="155" height="10" isPrintWhenDetailOverflows="true" printWhenGroupChanges="g_pago" uuid="bdd14240-b0af-4407-b91c-99fd0a13c90e" />
        <textElement markup="none">
          <font size="6" isBold="true" />
        </textElement>
        <text><![CDATA[Producto]]></text>
      </staticText>
      <staticText>
        <reportElement x="540" y="13" width="43" height="10" isPrintWhenDetailOverflows="true" printWhenGroupChanges="g_pago" uuid="3118187d-e9b6-4a61-86bd-a704400912cd" />
        <textElement textAlignment="Right" markup="none">
          <font size="6" isBold="true" />
        </textElement>
        <text><![CDATA[Total Item]]></text>
      </staticText>
      <staticText>
        <reportElement x="681" y="13" width="19" height="10" isPrintWhenDetailOverflows="true" printWhenGroupChanges="g_pago" uuid="49ba5256-0032-436c-8a89-afbd9cea2106" />
        <textElement textAlignment="Right" markup="none">
          <font size="6" isBold="true" />
        </textElement>
        <text><![CDATA[%]]></text>
      </staticText>
      <staticText>
        <reportElement x="736" y="13" width="36" height="10" isPrintWhenDetailOverflows="true" printWhenGroupChanges="g_pago" uuid="47968d0f-01ee-4ebc-8042-918031497a99" />
        <textElement textAlignment="Right" markup="none">
          <font size="6" isBold="true" />
        </textElement>
        <text><![CDATA[Comision]]></text>
      </staticText>
      <staticText>
        <reportElement x="583" y="13" width="34" height="10" isPrintWhenDetailOverflows="true" printWhenGroupChanges="g_pago" uuid="d8d68008-5cc1-47c4-9748-b77dde5683ef" />
        <textElement textAlignment="Right" markup="none">
          <font size="6" isBold="true" />
        </textElement>
        <text><![CDATA[T.C]]></text>
      </staticText>
      <staticText>
        <reportElement x="628" y="13" width="43" height="10" isPrintWhenDetailOverflows="true" printWhenGroupChanges="g_pago" uuid="ad3023f7-6785-49cf-8c6c-17eb86d2f7e8" />
        <textElement textAlignment="Right" markup="none">
          <font size="6" isBold="true" />
        </textElement>
        <text><![CDATA[Total Soles]]></text>
      </staticText>
      <line>
        <reportElement x="0" y="33" width="794" height="1" uuid="405c5ad2-d97b-4a37-bdc9-ac120aaaec41" />
      </line>
      <line>
        <reportElement x="0" y="6" width="794" height="1" uuid="6bcca7f6-f4a7-46c1-b2d0-9645f577b13c" />
      </line>
      <staticText>
        <reportElement x="706" y="13" width="28" height="10" isPrintWhenDetailOverflows="true" printWhenGroupChanges="g_pago" uuid="b01d101d-0bd6-4ea4-bfa0-17a4fc6f0d38" />
        <textElement markup="none">
          <font size="6" isBold="true" />
        </textElement>
        <text><![CDATA[Factor]]></text>
      </staticText>
    </band>
  </columnHeader>
  <detail>
    <band height="10" splitType="Stretch">
      <textField>
        <reportElement x="48" y="0" width="47" height="10" isPrintWhenDetailOverflows="true" uuid="03c9cd32-e11d-4fae-b9a6-c339c3fbfef0">
          <printWhenExpression><![CDATA[new Boolean($V{g_pago_COUNT}.intValue() == 1)]]></printWhenExpression>
        </reportElement>
        <textElement>
          <font size="6" />
        </textElement>
        <textFieldExpression><![CDATA[$F{pagonro}]]></textFieldExpression>
      </textField>
      <textField evaluationTime="Group" evaluationGroup="g_pago" pattern="dd/MM/yyyy">
        <reportElement x="0" y="0" width="37" height="10" isPrintWhenDetailOverflows="true" printWhenGroupChanges="g_pago" uuid="18458c4e-ebc8-44d6-b380-0a38c0e5f825" />
        <textElement>
          <font size="6" />
        </textElement>
        <textFieldExpression><![CDATA[$F{pagofecha}]]></textFieldExpression>
      </textField>
      <textField>
        <reportElement x="95" y="0" width="13" height="10" isPrintWhenDetailOverflows="true" uuid="9f37b577-5b32-4dda-8e94-82458b3f438a">
          <printWhenExpression><![CDATA[new Boolean($V{g_docnro_COUNT}.intValue() == 1)]]></printWhenExpression>
        </reportElement>
        <textElement>
          <font size="6" />
        </textElement>
        <textFieldExpression><![CDATA[$F{iso_code}]]></textFieldExpression>
      </textField>
      <textField pattern="#,##0.00;-#,##0.00">
        <reportElement x="106" y="0" width="32" height="10" isPrintWhenDetailOverflows="true" uuid="c871c691-ca82-48f0-921f-47fdab8f3193">
          <printWhenExpression><![CDATA[new Boolean($V{g_docnro_COUNT}.intValue() == 1)]]></printWhenExpression>
        </reportElement>
        <textElement textAlignment="Right">
          <font size="6" />
        </textElement>
        <textFieldExpression><![CDATA[$F{payamt}]]></textFieldExpression>
      </textField>
      <textField>
        <reportElement x="187" y="0" width="27" height="10" isPrintWhenDetailOverflows="true" uuid="a6ead62d-d5cc-4818-8448-c2501f74a361" />
        <textElement>
          <font size="6" />
        </textElement>
        <textFieldExpression><![CDATA[$F{paiddocnro}]]></textFieldExpression>
      </textField>
      <textField isBlankWhenNull="true">
        <reportElement x="142" y="0" width="22" height="10" isPrintWhenDetailOverflows="true" uuid="83969768-134e-4e26-afb1-2f56eafa3637" />
        <textElement>
          <font size="6" />
        </textElement>
        <textFieldExpression><![CDATA[$F{orderNro}]]></textFieldExpression>
      </textField>
      <textField isStretchWithOverflow="true">
        <reportElement x="219" y="0" width="136" height="10" uuid="a8686814-7970-4c57-8d10-58977c24aac2" />
        <textElement>
          <font size="6" />
        </textElement>
        <textFieldExpression><![CDATA[$F{partnername}]]></textFieldExpression>
      </textField>
      <textField isStretchWithOverflow="true">
        <reportElement x="369" y="0" width="155" height="10" uuid="d8b029f2-9b13-4014-acc1-1b1af1056d23" />
        <textElement>
          <font size="6" />
        </textElement>
        <textFieldExpression><![CDATA[$F{productname}]]></textFieldExpression>
      </textField>
      <textField>
        <reportElement x="527" y="0" width="11" height="10" uuid="2b079e74-03c6-4fec-a734-cda87f5c735b" />
        <textElement>
          <font size="6" />
        </textElement>
        <textFieldExpression><![CDATA[$F{isocodeitem}]]></textFieldExpression>
      </textField>
      <textField pattern="#,##0.00;-#,##0.00">
        <reportElement x="681" y="0" width="19" height="10" uuid="c911ad69-83db-48dc-865e-30396ecf927d" />
        <textElement textAlignment="Right">
          <font size="6" />
        </textElement>
        <textFieldExpression><![CDATA[$F{plannedqty}]]></textFieldExpression>
      </textField>
      <textField>
        <reportElement x="167" y="0" width="15" height="10" uuid="449b0efe-331d-4c70-9d89-e5f0246acfc7" />
        <textElement>
          <font size="6" />
        </textElement>
        <textFieldExpression><![CDATA[$F{docpagotipo}]]></textFieldExpression>
      </textField>
      <textField>
        <reportElement x="37" y="0" width="11" height="10" uuid="117dbc13-173b-46f6-93f3-5dd85f9b5b0d">
          <printWhenExpression><![CDATA[new Boolean($V{g_pago_COUNT}.intValue() == 1)]]></printWhenExpression>
        </reportElement>
        <textElement>
          <font size="6" />
        </textElement>
        <textFieldExpression><![CDATA[$F{pagotipo}]]></textFieldExpression>
      </textField>
      <textField pattern="#,##0.00" isBlankWhenNull="false">
        <reportElement mode="Transparent" x="628" y="0" width="44" height="10" forecolor="#000000" backcolor="#FFFFFF" uuid="7ca29d27-bb5f-459a-9daa-bc2a5f5957b6" />
        <textElement textAlignment="Right" verticalAlignment="Top" rotation="None" markup="none">
          <font fontName="SansSerif" size="6" isBold="false" isItalic="false" isUnderline="false" isStrikeThrough="false" pdfFontName="Helvetica" pdfEncoding="Cp1252" isPdfEmbedded="false" />
          <paragraph lineSpacing="Single" />
        </textElement>
        <textFieldExpression><![CDATA[$V{totSolesItem}]]></textFieldExpression>
      </textField>
      <textField pattern="#,##0.0000" isBlankWhenNull="false">
        <reportElement mode="Transparent" x="583" y="0" width="34" height="10" forecolor="#000000" backcolor="#FFFFFF" uuid="cea643e0-97d2-4bf8-a59e-2cde6e5c12bd" />
        <textElement textAlignment="Right" verticalAlignment="Top" rotation="None" markup="none">
          <font fontName="SansSerif" size="6" isBold="false" isItalic="false" isUnderline="false" isStrikeThrough="false" pdfFontName="Helvetica" pdfEncoding="Cp1252" isPdfEmbedded="false" />
          <paragraph lineSpacing="Single" />
        </textElement>
        <textFieldExpression><![CDATA[$F{tcitem}]]></textFieldExpression>
      </textField>
      <textField pattern="#,##0.00;-#,##0.00" isBlankWhenNull="false">
        <reportElement mode="Transparent" x="540" y="0" width="43" height="10" forecolor="#000000" backcolor="#FFFFFF" uuid="a76fe23e-2fce-48ab-9e95-7b9fd6efff7a" />
        <textElement textAlignment="Right" verticalAlignment="Top" rotation="None" markup="none">
          <font fontName="SansSerif" size="6" isBold="false" isItalic="false" isUnderline="false" isStrikeThrough="false" pdfFontName="Helvetica" pdfEncoding="Cp1252" isPdfEmbedded="false" />
          <paragraph lineSpacing="Single" />
        </textElement>
        <textFieldExpression><![CDATA[$F{itembasedolares}.add($F{itembasesoles}).add($F{itembaseeuros})]]></textFieldExpression>
      </textField>
      <textField pattern="#,##0.00;-#,##0.00" isBlankWhenNull="false">
        <reportElement mode="Transparent" x="706" y="0" width="28" height="10" forecolor="#000000" backcolor="#FFFFFF" uuid="ed22c376-b2c8-4855-b39f-b02930c08566" />
        <textElement textAlignment="Right" verticalAlignment="Top" rotation="None" markup="none">
          <font fontName="SansSerif" size="6" isBold="false" isItalic="false" isUnderline="false" isStrikeThrough="false" pdfFontName="Helvetica" pdfEncoding="Cp1252" isPdfEmbedded="false" />
          <paragraph lineSpacing="Single" />
        </textElement>
        <textFieldExpression><![CDATA[$F{factor}]]></textFieldExpression>
      </textField>
      <textField pattern="#,##0.00;-#,##0.00" isBlankWhenNull="false">
        <reportElement mode="Transparent" x="736" y="0" width="36" height="10" forecolor="#000000" backcolor="#FFFFFF" uuid="03a44714-359b-4a5e-9bed-7fb40088550a" />
        <textElement textAlignment="Right" verticalAlignment="Top" rotation="None" markup="none">
          <font fontName="SansSerif" size="6" isBold="false" isItalic="false" isUnderline="false" isStrikeThrough="false" pdfFontName="Helvetica" pdfEncoding="Cp1252" isPdfEmbedded="false" />
          <paragraph lineSpacing="Single" />
        </textElement>
        <textFieldExpression><![CDATA[($F{factor}.doubleValue() > 93.99 && $F{factor}.doubleValue() < 94.01) ?
    $V{totSolesItem}.multiply(new BigDecimal(100)).multiply($F{plannedqty}).divide(new BigDecimal(10000))
:
    $V{totSolesItem}.multiply($F{factor}).multiply($F{plannedqty}).divide(new BigDecimal(10000))]]></textFieldExpression>
      </textField>
    </band>
  </detail>
  <columnFooter>
    <band height="9" />
  </columnFooter>
  <pageFooter>
    <band height="17" splitType="Stretch" />
  </pageFooter>
  <summary>
    <band height="50">
      <textField pattern="#,##0.00" isBlankWhenNull="false">
        <reportElement mode="Transparent" x="717" y="6" width="55" height="10" forecolor="#000000" backcolor="#FFFFFF" uuid="7a9f5f6b-ca94-40d0-a796-3ac5a8a3764f" />
        <textElement textAlignment="Right" verticalAlignment="Top" rotation="None" markup="none">
          <font fontName="SansSerif" size="6" isBold="true" isItalic="false" isUnderline="false" isStrikeThrough="false" pdfFontName="Helvetica" pdfEncoding="Cp1252" isPdfEmbedded="false" />
          <paragraph lineSpacing="Single" />
        </textElement>
        <textFieldExpression><![CDATA[$V{comision_2}]]></textFieldExpression>
      </textField>
      <textField pattern="#,##0.00;-#,##0.00" isBlankWhenNull="false">
        <reportElement mode="Transparent" x="617" y="6" width="55" height="10" forecolor="#000000" backcolor="#FFFFFF" uuid="1fa5b80d-29c6-40b3-ba7e-56e88c2567ba" />
        <textElement textAlignment="Right" verticalAlignment="Top" rotation="None" markup="none">
          <font fontName="SansSerif" size="6" isBold="true" isItalic="false" isUnderline="false" isStrikeThrough="false" pdfFontName="Helvetica" pdfEncoding="Cp1252" isPdfEmbedded="false" />
          <paragraph lineSpacing="Single" />
        </textElement>
        <textFieldExpression><![CDATA[$V{comision_1}]]></textFieldExpression>
      </textField>
      <line>
        <reportElement x="617" y="3" width="55" height="1" uuid="f5d627ef-feb8-4d58-9ab9-33cf6ec91fd1" />
      </line>
      <line>
        <reportElement x="717" y="3" width="55" height="1" uuid="73a1a7c2-c9bf-433a-8372-9c13643352bf" />
      </line>
      <staticText>
        <reportElement x="430" y="6" width="184" height="10" isPrintWhenDetailOverflows="true" printWhenGroupChanges="g_pago" uuid="f79acf61-6f72-4d0c-a728-b4d988759fb5" />
        <textElement textAlignment="Right" markup="none">
          <font size="6" isBold="true" />
        </textElement>
        <text><![CDATA[TOTALES :]]></text>
      </staticText>
    </band>
  </summary>
  <noData>
    <band height="50">
      <staticText>
        <reportElement x="177" y="17" width="441" height="17" uuid="bff2f215-c329-40ad-b565-929bbc667c2f" />
        <textElement textAlignment="Center">
          <font isBold="true" />
        </textElement>
        <text><![CDATA[NO HAY VENTAS ASOCIADAS AL VENDEDOR SELECCIONADO]]></text>
      </staticText>
    </band>
  </noData>
</jasperReport>
